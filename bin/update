#!/usr/bin/env bash

# Gets macOS software updates, updates Homebrew, npm packages, dotfiles, and some other software.

# shellcheck disable=SC1091
. "$HOME/.dotfiles/tools/reporter.sh"

sudo -v
echo

# dotfiles
dotfiles

# Update oh-my-zsh
function update_omz() {
  info "Updating oh-my-zsh..."
  "$ZSH/tools/upgrade.sh"
  finish
}

# Update macOS system apps
function update_macos() {
  info "Updating macOS..."
  sudo -v
  sudo softwareupdate -i -a
  finish
}

# Update and clean Homebrew
function update_homebrew() {
  info "Updating Homebrew packages..."
  sudo -v
  brew update
  brew upgrade
  brew autoremove
  brew cleanup --prune=all -s
  finish
}

# Update npm packages
function update_npm() {
  info "Updating npm modules..."
  npm update -g
  finish
}

# Clear trash and log files
function clean_up() {
  info "Emptying trash and cleaning logs..."
  sudo command rm -rf ~/.Trash/*
  sudo command rm -rfv /Volumes/*/.Trashes
  sudo command rm -rfv /private/var/log/asl/*.asl
  finish
}

update() {
  update_omz "$*"
  update_macos "$*"
  update_homebrew "$*"
  update_npm "$*"
  clean_up "$*"
  on_finish "$*"
}

update "$*"

